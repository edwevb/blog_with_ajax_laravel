$(".modal").on("shown.bs.modal",function(){$(this).find("[autofocus]").focus()}),$(document).ready(function(){$("#body").summernote({placeholder:"Write here..",tabsize:2,height:350,dialogsInBody:!0,dialogsFade:!0,styleTags:["h1","h2","h3","h4","h5","h6",{title:"Normal",tag:"p",className:"",value:"div"},{title:"Paragraph",tag:"p",className:"",value:"p"},{title:"code",tag:"p",className:"",value:"pre"},{title:"Blockquote",tag:"p",className:"blockquote",value:"blockquote"}],toolbar:[["style",["style","undo","redo"]],["insert",["hr","table","link","picture","video","prettyprint"]],["font",["bold","italic","underline","superscript","subscript","clear"]],["para",["ul","ol","paragraph"]],["fontname",["fontname","fontsize","color"]],["view",["fullscreen","codeview","preview","help"]]],codemirror:{mode:"text/html",lineNumbers:!0,theme:"monokai"}})});let $selectCategory=$("#category").selectize({plugins:["restore_on_backspace"]}),selectCategory=$selectCategory,$selectTags=$("#tags").selectize({plugins:["remove_button","restore_on_backspace"],preload:!0,create:!0,persist:!1,allowEmptyOption:!1,maxItems:5}),selectTags=$selectTags;$(".custom-file-input").on("change",function(){let e=$(this).val().split("\\").pop();$(".custom-file-label").text(e)}),$(document).on("click","#addButton",async()=>{await removeValidationElem(),document.getElementById("postForm").reset(),$(".btn-save").val("add"),$(".modal-title").text("Add post"),$("#postsModal").modal({backdrop:"static",keyboard:!1}),await setFormValueBeforeAjaxPost()}),$(document).on("click","#editButton",async function(){await removeValidationElem();const e=`/admin/posts/${$(this).val()}/edit`;$.get(e,async function(e){$(".btn-save").val("update"),$("#postsModal").modal({backdrop:"static",keyboard:!1}),$(".modal-title").text("Update post"),await setFormValueBeforeAjaxPut(e)})});const setFormValueBeforeAjaxPost=e=>{$(".btn-save").attr("name",null),$("#body").summernote("code",null),selectCategory[0].selectize.setValue(),selectTags[0].selectize.setValue(),$(".custom-file-label").addClass("selected").html("Choose file")},setFormValueBeforeAjaxPut=e=>{$(".btn-save").attr("name",e.id),$("#title").val(e.title),$("#body").summernote("code",e.body),selectCategory[0].selectize.setValue(e.category_id),selectTags[0].selectize.setValue(e.tags.map(e=>e.name)),$(".custom-file-label").addClass("selected").html(e.thumb)};$("#postsModal form").on("submit",function(e){e.preventDefault(),removeValidationElem();const t=appendFormData(),o=$(".btn-save").val(),a=$(".btn-save").attr("name");"add"==o?url="/admin/posts":(url=`/admin/posts/${a}`,t.append("_method","put")),$.ajax({method:"POST",url:url,data:t,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},contentType:!1,processData:!1,dataType:"json",success:e=>{console.log(e),successAlert(e.message),$("#postsModal").modal("hide")},error:e=>{console.log(e.responseText),Swal.fire({icon:"error",title:"Oops...",text:"Something error, please check your input!",showCloseButton:!0}).then(()=>{formValidationShow(e)})}})});const appendFormData=()=>{const e=new FormData;e.append("_token",$("input[name=_token]").val()),e.append("title",$("#title").val()),e.append("body",$("#body").summernote("code")),e.append("category",$("#category").val());const t=$("#thumb")[0].files[0];e.append("thumb",t||"");const o=$("#tags").val();for(var a=0;a<o.length;a++)e.append("tags[]",o[a]);return e};$(document).on("click","#deleteButton",function(){const e=$('meta[name="csrf-token"]').attr("content"),t=$(this).val(),o=`/admin/posts/${t}`,a={id:t,_token:e};Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(e=>{e.isConfirmed&&$.ajax({type:"DELETE",url:o,data:a,dataType:"json",success:e=>{console.log(e),successAlert(e.message)},error:e=>{console.log(e.responseText)}})})});const formValidationShow=e=>{const t=e.responseJSON;let o="";0==$.isEmptyObject(t)&&$.each(t.errors,(e,t)=>{if(-1!=e.indexOf(".")){const t=e.split(".");o=$(`#${t[0]}`)}else o=$(`#${e}`);o.closest(".form-control").addClass("is-invalid"),o.closest(".form-group").append(`<div class="invalid-feedback">${t}</div>`)})},successAlert=e=>{Swal.fire({title:"Loading..",timer:2e3,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,didOpen:()=>{Swal.showLoading()}}).then(()=>{Swal.fire({icon:"success",iconColor:"#38C172",title:e,showCloseButton:!0}).then(()=>{table.draw()})})},removeValidationElem=()=>{const e=$("#postForm");e.find(".invalid-feedback").remove(),e.find(".form-control").removeClass("is-invalid")};